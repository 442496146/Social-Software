(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-chat/user-chat"],{2402:function(t,e,n){"use strict";n.r(e);var r=n("4b40"),o=n.n(r);for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=o.a},2793:function(t,e,n){},"2fad":function(t,e,n){"use strict";var r=n("2793"),o=n.n(r);o.a},"4b40":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(n("4795"));o(n("5378"));function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){return l(t)||s(t,e)||u(t,e)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"===typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0)if(n.push(a.value),e&&n.length===e)break}catch(c){o=!0,i=c}finally{try{r||null==u["return"]||u["return"]()}finally{if(o)throw i}}return n}}function l(t){if(Array.isArray(t))return t}function f(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(s){return void n(s)}u.done?e(c):Promise.resolve(c).then(r,o)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){f(i,r,o,a,u,"next",t)}function u(t){f(i,r,o,a,u,"throw",t)}a(void 0)}))}}var d=function(){n.e("components/user-chat/user-chat-bottom").then(function(){return resolve(n("91d1"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/user-chat/user-chat-list").then(function(){return resolve(n("ad29"))}.bind(null,n)).catch(n.oe)},m={components:{userChatBottom:d,userChatList:p},data:function(){return{scrollTop:0,style:{contentH:0,itemH:0},list:[],loadtext:"点击加载更多"}},onLoad:function(e){var n=JSON.parse(e.userinfo);if(!n.userid)return t.showToast({title:"该用户不存在",icon:"none"}),t.navigateBack({delta:1});this.$chat.CurrentToUser={userid:n.userid,username:n.username,userpic:n.userpic},t.setNavigationBarTitle({title:n.username})},onUnload:function(){this.$chat.CurrentToUser={userid:0,username:"",userpic:""}},onReady:function(){this.__init()},methods:{__init:function(){var e=this;try{var n=t.getSystemInfoSync();this.style.contentH=n.windowHeight-t.upx2px(120)}catch(r){}this.getdata(),this.pageToBottom(!0),t.$on("UserChat",(function(t){e.list.push(e.$chat.__format(t,{type:"chatdetail",isme:!1,olddata:e.list})),e.pageToBottom()}))},pageToBottom:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=t.createSelectorQuery().in(this),i=o.selectAll(".chat-item");this.$nextTick((function(){i.fields({size:!0},(function(t){if(t){if(n){e.style.itemH=0;for(var o=0;o<t.length;o++)e.style.itemH+=t[o].height}else e.style.itemH+=t.length>0?t[t.length-1].height:t[0].height;r&&(e.scrollTop=e.style.itemH>e.style.contentH?e.style.itemH:0)}})).exec()}))},getdata:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var n="chatdetail_"+this.User.userinfo.id+"_"+this.$chat.CurrentToUser.userid,r=t.getStorageSync(n);if(r=r?JSON.parse(r):[],!e&&r.length>10)return this.list=r.splice(0,10);this.list=r,this.loadtext=""}catch(o){t.showToast({title:"加载失败~",icon:"none"})}},submit:function(e){var n=this;return h(r.default.mark((function o(){var a,u,c,s,l;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return",t.showToast({title:"请输入你要发送的消息~",icon:"none"}));case 2:return a=n.$chat.send({type:"text",data:e}),r.next=5,n.$http.post("/chat/send",a,{token:!0,checkToken:!0,checkAuth:!0});case 5:if(u=r.sent,c=i(u,2),s=c[0],l=c[1],n.$http.errorCheck(s,l)){r.next=11;break}return r.abrupt("return",t.showToast({title:"发送失败",icon:"none"}));case 11:n.list.push(n.$chat.__format(a,{type:"chatdetail",olddata:n.list,isme:!0})),n.pageToBottom();case 13:case"end":return r.stop()}}),o)})))()},loadmore:function(){"点击加载更多"===this.loadtext&&(this.loadtext="加载中...",this.getdata(!0),this.pageToBottom(!0,!1))}}};e.default=m}).call(this,n("543d")["default"])},7431:function(t,e,n){"use strict";var r,o=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return r}))},a643:function(t,e,n){"use strict";(function(t){n("a2a3");r(n("66fd"));var e=r(n("c30d"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},c30d:function(t,e,n){"use strict";n.r(e);var r=n("7431"),o=n("2402");for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n("2fad");var a,u=n("f0c5"),c=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],a);e["default"]=c.exports}},[["a643","common/runtime","common/vendor"]]]);