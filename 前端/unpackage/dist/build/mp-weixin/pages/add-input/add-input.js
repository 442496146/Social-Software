(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/add-input/add-input"],{4107:function(t,n,e){"use strict";var i={uniNavBar:function(){return e.e("components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"97cc"))},uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"7e61"))}},s=function(){var t=this,n=t.$createElement;t._self._c},a=[];e.d(n,"b",(function(){return s})),e.d(n,"c",(function(){return a})),e.d(n,"a",(function(){return i}))},5619:function(t,n,e){"use strict";e.r(n);var i=e("4107"),s=e("6836");for(var a in s)"default"!==a&&function(t){e.d(n,t,(function(){return s[t]}))}(a);e("93a3");var r,o=e("f0c5"),c=Object(o["a"])(s["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);n["default"]=c.exports},6836:function(t,n,e){"use strict";e.r(n);var i=e("7519"),s=e.n(i);for(var a in i)"default"!==a&&function(t){e.d(n,t,(function(){return i[t]}))}(a);n["default"]=s.a},7519:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("4795"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,n){return l(t)||u(t,n)||o(t,n)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t,n){if(t){if("string"===typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,n):void 0}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function u(t,n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var e=[],i=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done);i=!0)if(e.push(r.value),n&&e.length===n)break}catch(c){s=!0,a=c}finally{try{i||null==o["return"]||o["return"]()}finally{if(s)throw a}}return e}}function l(t){if(Array.isArray(t))return t}function p(t,n,e,i,s,a,r){try{var o=t[a](r),c=o.value}catch(u){return void e(u)}o.done?n(c):Promise.resolve(c).then(i,s)}function d(t){return function(){var n=this,e=arguments;return new Promise((function(i,s){var a=t.apply(n,e);function r(t){p(a,i,s,r,o,"next",t)}function o(t){p(a,i,s,r,o,"throw",t)}r(void 0)}))}}var f=["仅自己可见","所有人可见"],h=function(){e.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(e("97cc"))}.bind(null,e)).catch(e.oe)},g=function(){e.e("components/common/uploud-images").then(function(){return resolve(e("fc2a"))}.bind(null,e)).catch(e.oe)},v=function(){e.e("components/uni-popup/uni-popup").then(function(){return resolve(e("7e61"))}.bind(null,e)).catch(e.oe)},m={components:{uniNavBar:h,uploudImages:g,uniPopup:v},data:function(){return{isget:!1,showpopup:!0,yinsi:1,text:"",imglist:[],imglistIds:[],postclass:{id:0,title:"",range:[],list:[]},topic:{id:0,title:""}}},onBackPress:function(){if(this.text||!(this.imglist.length<1))return this.isget?void 0:(this.baocun(),!0)},computed:{getType:function(){return f[this.yinsi]}},onLoad:function(n){var e=this,i=t.getStorageSync("addinput");i&&(i=JSON.parse(i),this.yinsi=i.yinsi,this.imglistIds=i.imglistIds||[],this.imglistIds.length&&(this.imglist=i.imglist),this.text=i.text,i.postclass&&(this.postclass=i.postclass),i.topic&&(this.topic=i.topic));var s=!!n.postclass&&JSON.parse(n.postclass);this.getPostClass(s),t.$on("changeTopic",(function(t){e.topic.id=t.id,e.topic.title="#".concat(t.title,"#")}))},methods:{changeTopic:function(){t.navigateTo({url:"/pages/topic-nav/topic-nav?ischange="+!0})},getPostClass:function(t){var n=this;return d(i.default.mark((function e(){var s,r,o,c,u,l,p,d,f,h;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}for(n.postclass.list=t,s=[],r=0;r<t.length;r++)s.push(t[r].name);return e.abrupt("return",n.postclass.range=s);case 5:return e.prev=5,e.next=8,n.$http.get("/postclass");case 8:if(o=e.sent,c=a(o,2),u=c[0],l=c[1],n.$http.errorCheck(u,l)){e.next=14;break}return e.abrupt("return");case 14:for(p=l.data.data.list,d=[],f=[],h=0;h<p.length;h++)d.push(p[h].classname),f.push({id:p[h].id,name:p[h].classname});n.postclass.range=d,n.postclass.list=f,e.next=24;break;case 21:return e.prev=21,e.t0=e["catch"](5),e.abrupt("return");case 24:case"end":return e.stop()}}),e,null,[[5,21]])})))()},changePostClass:function(t){console.log(t),this.postclass.id=this.postclass.list[t.target.value].id,this.postclass.title=this.postclass.list[t.target.value].name,console.log(this.postclass.list[t.target.value])},baocun:function(){var n=this;t.showModal({content:"是否要保存为草稿？",cancelText:"不保存",confirmText:"保存",success:function(e){if(e.confirm){var i={yinsi:n.yinsi,text:n.text,imglist:n.imglist,imglistIds:n.imglistIds,postclass:n.postclass,topic:n.topic};t.setStorageSync("addinput",JSON.stringify(i))}else t.removeStorage({key:"addinput"});n.isget=!0,t.navigateBack({delta:1})}})},back:function(){t.navigateBack({delta:1})},submit:function(){var n=this;return d(i.default.mark((function e(){var s,r,o,c;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.postclass.id){e.next=2;break}return e.abrupt("return",t.showToast({title:"请选择分类",icon:"none"}));case 2:return t.showLoading({title:"发布中...",mask:!0}),e.prev=3,e.next=6,n.$http.post("/post/create",{imglist:JSON.stringify(n.imglistIds),text:n.text,isopen:n.yinsi,topic_id:n.topic.id,post_class_id:n.postclass.id},{token:!0,checkToken:!0,checkAuth:!0});case 6:if(s=e.sent,r=a(s,2),o=r[0],c=r[1],n.$http.errorCheck(o,c)){e.next=12;break}return e.abrupt("return",t.hideLoading());case 12:t.hideLoading(),t.showToast({title:"发布成功！"}),n.isget=!0,t.$emit("updateData",{type:"updateList",data:c.data.data.detail}),t.navigateBack({delta:1}),e.next=22;break;case 19:return e.prev=19,e.t0=e["catch"](3),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[3,19]])})))()},changelook:function(){var n=this;t.showActionSheet({itemList:f,success:function(t){n.yinsi=t.tapIndex}})},upload:function(t){this.imglist.push(t.url),this.imglistIds.push({id:t.id})},delImageList:function(t){this.imglist.splice(t,1),this.imglistIds.splice(t,1)},hidePopup:function(){this.showpopup=!1}}};n.default=m}).call(this,e("543d")["default"])},"76f8":function(t,n,e){},"93a3":function(t,n,e){"use strict";var i=e("76f8"),s=e.n(i);s.a},a76c:function(t,n,e){"use strict";(function(t){e("a2a3");i(e("66fd"));var n=i(e("5619"));function i(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])}},[["a76c","common/runtime","common/vendor"]]]);